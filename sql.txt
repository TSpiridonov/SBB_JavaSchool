
DROP TABLE IF EXISTS `passenger`;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8mb4;
CREATE TABLE `passenger` (
                             `id` int NOT NULL AUTO_INCREMENT,
                             `name` varchar(100) NOT NULL,
                             `surname` varchar(100) NOT NULL,
                             `birthdate` date NOT NULL,
                             PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=83 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
SET character_set_client = @saved_cs_client;

DROP TABLE IF EXISTS `role`;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8mb4;
CREATE TABLE `role` (
                        `id` int NOT NULL AUTO_INCREMENT,
                        `role_name` varchar(10) NOT NULL,
                        PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
SET character_set_client = @saved_cs_client;



ALTER TABLE `role` DISABLE KEYS;
INSERT INTO `role` VALUES (1,'ROLE_USER'),(2,'ROLE_ADMIN');


DROP TABLE IF EXISTS `schedule`;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8mb4;
CREATE TABLE `schedule` (
                            `id` int NOT NULL AUTO_INCREMENT,
                            `trip_id` int NOT NULL,
                            `station_index` int NOT NULL,
                            `station_from` int NOT NULL,
                            `station_to` int NOT NULL,
                            `departure_time` timestamp NOT NULL,
                            `arrival_time` timestamp NOT NULL,
                            PRIMARY KEY (`id`),
                            KEY `fk_schedule_to_station1_idx` (`station_from`),
                            KEY `fk_schedule_to_stationto_idx` (`station_to`),
                            KEY `fk_schedule_to_trip_idx` (`trip_id`),
                            CONSTRAINT `fk_schedule_to_stationfrom` FOREIGN KEY (`station_from`) REFERENCES `station` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                            CONSTRAINT `fk_schedule_to_stationto` FOREIGN KEY (`station_to`) REFERENCES `station` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                            CONSTRAINT `fk_schedule_to_trip` FOREIGN KEY (`trip_id`) REFERENCES `trip` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=114 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
SET character_set_client = @saved_cs_client;


DROP TABLE IF EXISTS `station`;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8mb4;
CREATE TABLE `station` (
                           `id` int NOT NULL AUTO_INCREMENT,
                           `title` varchar(50) NOT NULL,
                           PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=37 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
SET character_set_client = @saved_cs_client;


DROP TABLE IF EXISTS `ticket`;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8mb4;
CREATE TABLE `ticket` (
                          `id` int NOT NULL AUTO_INCREMENT,
                          `train_id` int NOT NULL,
                          `trip_id` int NOT NULL,
                          `station_from_id` int NOT NULL,
                          `station_to_id` int NOT NULL,
                          `departure_time` timestamp NOT NULL,
                          `arrival_time` timestamp NOT NULL,
                          `passenger_id` int NOT NULL,
                          `user_id` int DEFAULT NULL,
                          PRIMARY KEY (`id`),
                          KEY `fk_ticket_to_train_idx` (`train_id`),
                          KEY `fk_ticket_to_station1_idx` (`station_from_id`),
                          KEY `fk_ticket_to_station2_idx` (`station_to_id`),
                          KEY `fk_ticket_to_passenger_idx` (`passenger_id`),
                          KEY `fk_ticket_to_user_idx` (`user_id`),
                          KEY `fk_ticket_to_trip_idx` (`trip_id`),
                          CONSTRAINT `fk_ticket_to_passenger` FOREIGN KEY (`passenger_id`) REFERENCES `passenger` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                          CONSTRAINT `fk_ticket_to_station1` FOREIGN KEY (`station_from_id`) REFERENCES `station` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                          CONSTRAINT `fk_ticket_to_station2` FOREIGN KEY (`station_to_id`) REFERENCES `station` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                          CONSTRAINT `fk_ticket_to_train` FOREIGN KEY (`train_id`) REFERENCES `train` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                          CONSTRAINT `fk_ticket_to_trip` FOREIGN KEY (`trip_id`) REFERENCES `trip` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                          CONSTRAINT `fk_ticket_to_user` FOREIGN KEY (`user_id`) REFERENCES 'user' (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
SET character_set_client = @saved_cs_client;


DROP TABLE IF EXISTS `train`;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8mb4;
CREATE TABLE `train` (
                         `id` int NOT NULL AUTO_INCREMENT,
                         `number` varchar(30) NOT NULL,
                         `capacity` int NOT NULL,
                         PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
SET character_set_client = @saved_cs_client;

DROP TABLE IF EXISTS `trip`;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8mb4;
CREATE TABLE `trip` (
                        `id` int NOT NULL AUTO_INCREMENT,
                        `train_id` int NOT NULL,
                        `departure_station_id` int NOT NULL,
                        `arrival_station_id` int NOT NULL,
                        `departure_time` timestamp NOT NULL,
                        `arrival_time` timestamp NOT NULL,
                        PRIMARY KEY (`id`),
                        KEY `fk_trip_to_train_idx` (`train_id`),
                        KEY `fk_trip_to_station1_idx` (`departure_station_id`),
                        KEY `fk_trip_to_station2_idx` (`arrival_station_id`),
                        CONSTRAINT `fk_trip_arrivalstation_to_station` FOREIGN KEY (`arrival_station_id`) REFERENCES `station` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                        CONSTRAINT `fk_trip_departurestation_to_station` FOREIGN KEY (`departure_station_id`) REFERENCES `station` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
                        CONSTRAINT `fk_trip_to_train` FOREIGN KEY (`train_id`) REFERENCES `train` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=29 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
SET character_set_client = @saved_cs_client;


DROP TABLE IF EXISTS `user`;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8mb4;
CREATE TABLE `user` (
                        `id` int NOT NULL AUTO_INCREMENT,
                        `username` varchar(50) NOT NULL,
                        `password` varchar(500) NOT NULL,
                        `role_id` int NOT NULL,
                        PRIMARY KEY (`id`),
                        UNIQUE KEY `username_UNIQUE` (`username`),
                        KEY `fk_user_to_role_idx` (`role_id`),
                        CONSTRAINT `fk_user_to_role` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
SET character_set_client = @saved_cs_client;


